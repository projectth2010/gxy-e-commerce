<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="980px" preserveAspectRatio="none" style="width:725px;height:980px;background:#FFFFFF;" version="1.1" viewBox="0 0 725 980" width="725px" zoomAndPan="magnify"><title>Loyalty Accrual &amp; Redemption (Concept)</title><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="320.626" x="198.449" y="27.9951">Loyalty Accrual &amp; Redemption (Concept)</text><g><title>Customer . Staff UI</title><rect fill="#000000" fill-opacity="0.00000" height="839.25" width="8" x="74.7085" y="89.8906"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="78" x2="78" y1="89.8906" y2="929.1406"/></g><g><title>Tenant App</title><rect fill="#000000" fill-opacity="0.00000" height="839.25" width="8" x="265.8423" y="89.8906"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="269.2544" x2="269.2544" y1="89.8906" y2="929.1406"/></g><g><title>Loyalty Service</title><rect fill="#000000" fill-opacity="0.00000" height="839.25" width="8" x="474.5654" y="89.8906"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="478.269" x2="478.269" y1="89.8906" y2="929.1406"/></g><g><title>Analytics Platform</title><rect fill="#000000" fill-opacity="0.00000" height="839.25" width="8" x="638.8677" y="89.8906"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="642.2114" x2="642.2114" y1="89.8906" y2="929.1406"/></g><g class="participant participant-head" data-participant="UI"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="147.417" x="5" y="42.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="133.2598" x="12.0786" y="62.292">Customer / Staff UI</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="133.417" x="12" y="78.5889">(Storefront or POS)</text></g><g class="participant participant-tail" data-participant="UI"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="147.417" x="5" y="928.1406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="133.2598" x="12.0786" y="948.1357">Customer / Staff UI</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="133.417" x="12" y="964.4326">(Storefront or POS)</text></g><g class="participant participant-head" data-participant="TenantApp"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="183.1758" x="178.2544" y="42.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80.7803" x="229.4521" y="62.292">Tenant App</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="169.1758" x="185.2544" y="78.5889">(Order &amp; Loyalty Hooks)</text></g><g class="participant participant-tail" data-participant="TenantApp"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="183.1758" x="178.2544" y="928.1406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80.7803" x="229.4521" y="948.1357">Tenant App</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="169.1758" x="185.2544" y="964.4326">(Order &amp; Loyalty Hooks)</text></g><g class="participant participant-head" data-participant="Loy"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="134.5928" x="411.269" y="42.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107.085" x="425.0229" y="62.292">Loyalty Service</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="120.5928" x="418.269" y="78.5889">(Loyalty Domain)</text></g><g class="participant participant-tail" data-participant="Loy"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="134.5928" x="411.269" y="928.1406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107.085" x="425.0229" y="948.1357">Loyalty Service</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="120.5928" x="418.269" y="964.4326">(Loyalty Domain)</text></g><g class="participant participant-head" data-participant="Analyt"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="141.3125" x="572.2114" y="58.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="127.3125" x="579.2114" y="78.5889">Analytics Platform</text></g><g class="participant participant-tail" data-participant="Analyt"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="141.3125" x="572.2114" y="928.1406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="127.3125" x="579.2114" y="948.1357">Analytics Platform</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="718.5239" x="0" y="120.457"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="718.5239" y1="120.457" y2="120.457"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="718.5239" y1="123.457" y2="123.457"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="306.2397" x="206.1421" y="109.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="287.7139" x="212.1421" y="125.9575">During Checkout: Optional Redemption</text><g class="message" data-participant-1="UI" data-participant-2="TenantApp"><polygon fill="#181818" points="257.8423,175.2891,267.8423,179.2891,257.8423,183.2891,261.8423,179.2891" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="78.7085" x2="263.8423" y1="179.2891" y2="179.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141.4766" x="85.7085" y="159.0903">Load cart + customer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113.9976" x="85.7085" y="174.2231">(with loyalty info)</text></g><g class="message" data-participant-1="TenantApp" data-participant-2="Loy"><polygon fill="#181818" points="466.5654,219.5547,476.5654,223.5547,466.5654,227.5547,470.5654,223.5547" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="269.8423" x2="472.5654" y1="223.5547" y2="223.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181.8667" x="276.8423" y="203.356">Get loyalty balance &amp; offers</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158.9897" x="276.8423" y="218.4888">(customer_id, tenant_id)</text></g><g class="message" data-participant-1="Loy" data-participant-2="TenantApp"><polygon fill="#181818" points="280.8423,263.8203,270.8423,267.8203,280.8423,271.8203,276.8423,267.8203" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="274.8423" x2="477.5654" y1="267.8203" y2="267.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98.96" x="286.8423" y="247.6216">Points balance,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130.0952" x="286.8423" y="262.7544">redeemable options</text></g><g class="message" data-participant-1="UI" data-participant-2="TenantApp"><polygon fill="#181818" points="257.8423,308.0859,267.8423,312.0859,257.8423,316.0859,261.8423,312.0859" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="78.7085" x2="263.8423" y1="312.0859" y2="312.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164.0044" x="85.7085" y="291.8872">Apply loyalty redemption</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94.396" x="85.7085" y="307.02">(points to use)</text></g><g class="message" data-participant-1="TenantApp" data-participant-2="Loy"><polygon fill="#181818" points="466.5654,352.3516,476.5654,356.3516,466.5654,360.3516,470.5654,356.3516" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="269.8423" x2="472.5654" y1="356.3516" y2="356.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165.0073" x="276.8423" y="336.1528">Validate &amp; reserve points</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94.8975" x="276.8423" y="351.2856">(for this order)</text></g><g class="message" data-participant-1="Loy" data-participant-2="TenantApp"><polygon fill="#181818" points="280.8423,381.4844,270.8423,385.4844,280.8423,389.4844,276.8423,385.4844" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="274.8423" x2="477.5654" y1="385.4844" y2="385.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129.7334" x="286.8423" y="380.4185">Reservation ok / fail</text></g><g class="message" data-participant-1="TenantApp" data-participant-2="UI"><polygon fill="#181818" points="89.7085,425.75,79.7085,429.75,89.7085,433.75,85.7085,429.75" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="83.7085" x2="268.8423" y1="429.75" y2="429.75"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95.9639" x="95.7085" y="409.5513">Updated totals</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161.021" x="95.7085" y="424.6841">(after redemption if any)</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="718.5239" x="0" y="458.3164"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="718.5239" y1="458.3164" y2="458.3164"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="718.5239" y1="461.3164" y2="461.3164"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="142.1592" x="288.1824" y="447.75"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="123.6333" x="294.1824" y="463.8169">Order Placement</text><g class="message" data-participant-1="UI" data-participant-2="TenantApp"><polygon fill="#181818" points="257.8423,513.1484,267.8423,517.1484,257.8423,521.1484,261.8423,517.1484" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="78.7085" x2="263.8423" y1="517.1484" y2="517.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="73.5884" x="85.7085" y="496.9497">Place order</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167.1338" x="85.7085" y="512.0825">(cart, loyalty redemption)</text></g><g class="message" data-participant-1="TenantApp" data-participant-2="TenantApp"><line style="stroke:#181818;stroke-width:1;" x1="269.8423" x2="311.8423" y1="561.4141" y2="561.4141"/><line style="stroke:#181818;stroke-width:1;" x1="311.8423" x2="311.8423" y1="561.4141" y2="574.4141"/><line style="stroke:#181818;stroke-width:1;" x1="270.8423" x2="311.8423" y1="574.4141" y2="574.4141"/><polygon fill="#181818" points="280.8423,570.4141,270.8423,574.4141,280.8423,578.4141,276.8423,574.4141" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82.5068" x="276.8423" y="541.2153">Create order</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148.3638" x="276.8423" y="556.3481">(include loyalty usage)</text></g><g class="message" data-participant-1="TenantApp" data-participant-2="Loy"><polygon fill="#181818" points="466.5654,614.6797,476.5654,618.6797,466.5654,622.6797,470.5654,618.6797" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="269.8423" x2="472.5654" y1="618.6797" y2="618.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131.0093" x="276.8423" y="598.481">Confirm redemption</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94.8975" x="276.8423" y="613.6138">(for this order)</text></g><g class="message" data-participant-1="Loy" data-participant-2="TenantApp"><polygon fill="#181818" points="280.8423,643.8125,270.8423,647.8125,280.8423,651.8125,276.8423,647.8125" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="274.8423" x2="477.5654" y1="647.8125" y2="647.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141.521" x="286.8423" y="642.7466">Redemption recorded</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="718.5239" x="0" y="676.3789"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="718.5239" y1="676.3789" y2="676.3789"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="718.5239" y1="679.3789" y2="679.3789"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="249.0791" x="234.7224" y="665.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="230.5532" x="240.7224" y="681.8794">Accrual After Order Completion</text><g class="message" data-participant-1="TenantApp" data-participant-2="Loy"><polygon fill="#181818" points="466.5654,731.2109,476.5654,735.2109,466.5654,739.2109,470.5654,735.2109" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="269.8423" x2="472.5654" y1="735.2109" y2="735.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88.8291" x="276.8423" y="715.0122">Accrue points</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184.7231" x="276.8423" y="730.145">(based on order value/rules)</text></g><g class="message" data-participant-1="Loy" data-participant-2="TenantApp"><polygon fill="#181818" points="280.8423,760.3438,270.8423,764.3438,280.8423,768.3438,276.8423,764.3438" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="274.8423" x2="477.5654" y1="764.3438" y2="764.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110.7729" x="286.8423" y="759.2778">Accrual recorded</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="718.5239" x="0" y="792.9102"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="718.5239" y1="792.9102" y2="792.9102"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="718.5239" y1="795.9102" y2="795.9102"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="85.6587" x="316.4326" y="782.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="67.1328" x="322.4326" y="798.4106">Analytics</text><g class="message" data-participant-1="Loy" data-participant-2="Analyt"><polygon fill="#181818" points="630.8677,862.875,640.8677,866.875,630.8677,870.875,634.8677,866.875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="478.5654" x2="636.8677" y1="866.875" y2="866.875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125.2773" x="485.5654" y="831.5435">Emit loyalty events</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140.3022" x="485.5654" y="846.6763">(accrual, redemption,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127.8101" x="485.5654" y="861.8091">customer, order_id)</text></g><g class="message" data-participant-1="TenantApp" data-participant-2="Analyt"><polygon fill="#181818" points="630.8677,907.1406,640.8677,911.1406,630.8677,915.1406,634.8677,911.1406" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="269.8423" x2="636.8677" y1="911.1406" y2="911.1406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116.543" x="276.8423" y="890.9419">Emit order events</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140.3149" x="276.8423" y="906.0747">(include loyalty flags)</text></g><!--SRC=[ZLF1Yjim4BtxAuOzB6lgiFUbMGZUqYuK4ZPDJmjb8eyI4LaoafpYl-zOYfqu-D2BuyZpthnvRnHKq0G_ROSwTB0ImhMeuH4-gAAw2SeQU2gj4TI4FCiQT449rQ09y52sFjYQ73p3Dg2Ki7l_D4_RO1r9Pxd2EjYij_a3eETlK_0lCltlgcaOitOLqpoECdvOU_89b-guR0eVAhVapaeGSmmdRxP6PHAOpwQmbK7TyLyF6ur1MbV7kdISPSiblBLEcGEKHn8dsuONM4SJs9CRHvRBRFSEYzUhEdZXPbY1u6xm1SJ56jRrLuKZw8iuPQJDiokAALWZWxzJ68lsg94DPp-ibEGyamnyVrHLG8XmVisp7houqx6noWG_i1IVnh5mgd7FETketsSpylcfkr636uVbxarY31PQJxFoVwDM5OPUioFFcH0a4AFPPGX7vNaTEELvpHyHXD5SU-A5agXqB_BhOZ4ft3Lzcugr1DGzEyh0gtEL2qe2cYwFOQQzugW5rSJvp-OMFoTnlTCSO35ZmztOjmIbetxqWK4PeTkAHexMus7UDRvNKhbwQlR_sJMEwqZqXLMSTxY-gsXAchwqTQDfMDiP5H5qazSUFHlS1n7nPzGjFRjMavyNCpITAXal6ZUDgDVB6IE-rUgwxNIcr1SJJt5Z1o_liFb5aXEtVZB4b3Lf7Zdliv0Q3px_1m00]--></g></svg>